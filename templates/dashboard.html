<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volvoway | Municipal Intelligence & Operational Command</title>
    
    <!-- External Assets: Optimized for Production -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* --- BRANDING & TYPOGRAPHY --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --primary-blue: #3b82f6;
            --primary-dark: #020617;
            --card-bg: rgba(15, 23, 42, 0.7);
            --border-color: rgba(30, 41, 59, 0.7);
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-amber: #f59e0b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-dark);
            color: #f8fafc;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(30, 64, 175, 0.05) 0%, transparent 40%);
        }

        .header-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* --- GLASSMORPHISM COMPONENTS --- */
        .glass-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(16px);
            border-radius: 1.5rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .glass-panel:hover {
            border-color: rgba(59, 130, 246, 0.5);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .glass-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--primary-blue);
        }

        /* --- NAVIGATION SIDEBAR --- */
        .sidebar-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-radius: 0.75rem;
            color: #94a3b8;
        }

        .sidebar-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-blue);
        }

        .sidebar-item.active {
            background: var(--primary-blue);
            color: white;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
        }

        /* --- TERMINAL STYLING --- */
        #terminal-container {
            background: #000;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
            border: 1px solid #1e293b;
        }

        #terminal-container::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.01), rgba(0, 255, 0, 0.005), rgba(0, 0, 255, 0.01));
            background-size: 100% 4px, 6px 100%;
            pointer-events: none;
        }

        /* --- ANIMATIONS --- */
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }

        .live-dot {
            position: relative;
        }

        .live-dot::before {
            content: '';
            position: absolute;
            left: -4px; top: -4px;
            width: 16px; height: 16px;
            border-radius: 50%;
            background-color: currentColor;
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .map-scan::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: var(--primary-blue);
            opacity: 0.2;
            animation: scanline 6s linear infinite;
            z-index: 5;
        }

        /* --- CUSTOM SCROLLBAR --- */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--primary-dark); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-blue); }

        .modal-enter { animation: modalFadeIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .tab-pane { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- 1. LATERAL NAVIGATION (Government Style) -->
    <aside class="w-20 lg:w-64 bg-slate-950/90 border-r border-slate-800/50 flex flex-col items-center lg:items-stretch p-4 z-50 shadow-2xl">
        <div class="mb-12 px-2 flex items-center gap-4">
            <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-blue-600/30 ring-1 ring-blue-400/20">
                <i class="fas fa-landmark text-white text-xl"></i>
            </div>
            <div class="hidden lg:block">
                <h2 class="header-font text-base font-black text-blue-400 tracking-tighter">VOLVOWAY</h2>
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Command Center</span>
            </div>
        </div>

        <nav class="flex-1 space-y-3">
            <div onclick="switchView('overview')" id="nav-overview" class="sidebar-item active p-4 flex items-center gap-4">
                <i class="fas fa-satellite-dish w-5 text-center"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Live Monitor</span>
            </div>
            <div onclick="switchView('analytics')" id="nav-analytics" class="sidebar-item p-4 flex items-center gap-4">
                <i class="fas fa-brain w-5 text-center"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Intelligence</span>
            </div>
            <div onclick="switchView('fleet')" id="nav-fleet" class="sidebar-item p-4 flex items-center gap-4">
                <i class="fas fa-id-card w-5 text-center"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Personnel</span>
            </div>
            <div onclick="switchView('reports')" id="nav-reports" class="sidebar-item p-4 flex items-center gap-4">
                <i class="fas fa-database w-5 text-center"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Audit Logs</span>
            </div>
        </nav>

        <div class="mt-auto space-y-3 pt-6 border-t border-slate-800/50">
            <div onclick="toggleModal('regModal')" class="sidebar-item p-4 flex items-center gap-4 text-blue-500 hover:text-white group">
                <i class="fas fa-plus-circle w-5 group-hover:rotate-90 transition-transform"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Provision Node</span>
            </div>
            <div class="p-4 flex items-center gap-4 text-slate-500">
                <i class="fas fa-microchip w-5"></i>
                <span class="hidden lg:block text-[11px] font-black uppercase tracking-widest">Kernel Specs</span>
            </div>
        </div>
    </aside>

    <!-- 2. MAIN WORKSPACE -->
    <main class="flex-1 flex flex-col relative overflow-hidden">
        
        <!-- TOP APP BAR -->
        <header class="h-20 border-b border-slate-800 flex items-center justify-between px-10 bg-slate-950/60 backdrop-blur-xl">
            <div class="flex items-center gap-8">
                <div class="hidden md:flex flex-col">
                    <span id="current-date" class="text-[9px] font-black text-slate-500 uppercase tracking-tighter">Awaiting Chronometer...</span>
                    <span id="current-time" class="text-sm font-black mono-font text-blue-400">00:00:00 UTC</span>
                </div>
                <div class="h-8 w-px bg-slate-800/50"></div>
                <div class="flex flex-col">
                    <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Sector Authority</span>
                    <span class="text-xs font-bold text-white uppercase flex items-center gap-2">
                        NE-04 <span class="text-[10px] text-slate-500">Basara Municipal</span>
                    </span>
                </div>
            </div>

            <div class="flex items-center gap-8">
                <div id="hw-status" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-red-950/20 border border-red-500/20 text-[10px] font-black text-red-500 shadow-inner">
                    <div class="w-2 h-2 rounded-full bg-red-500 live-dot"></div>
                    AWAITING UPLINK
                </div>
                <div class="flex items-center gap-4 pl-6 border-l border-slate-800/50">
                    <div class="text-right">
                        <p class="text-[10px] font-black text-white">Gov_Admin_V1</p>
                        <p class="text-[9px] font-bold text-slate-500 uppercase">Superuser Access</p>
                    </div>
                    <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center border border-blue-400/20 shadow-lg">
                        <i class="fas fa-user-shield text-white text-sm"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- CONTENT VIEWPORT -->
        <div id="viewport" class="flex-1 overflow-y-auto p-8 lg:p-12">
            
            <!-- VIEW: OVERVIEW -->
            <section id="view-overview" class="space-y-10 block opacity-0 transition-opacity duration-500">
                <!-- KPI SECTION -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="glass-panel p-8 border-l-4 border-blue-500">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em]">Provisioned Nodes</span>
                            <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-500">
                                <i class="fas fa-cube text-xs"></i>
                            </div>
                        </div>
                        <p id="stat-total-nodes" class="text-5xl font-black header-font tracking-tighter">0</p>
                        <div class="mt-6 flex items-center gap-2 text-[10px] text-green-500 font-black">
                            <i class="fas fa-check-circle"></i> SYSTEM SYNC ACTIVE
                        </div>
                    </div>
                    <div class="glass-panel p-8 border-l-4 border-red-500">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em]">Priority Alerts</span>
                            <div class="w-8 h-8 rounded-lg bg-red-500/10 flex items-center justify-center text-red-500">
                                <i class="fas fa-radiation text-xs"></i>
                            </div>
                        </div>
                        <p id="stat-critical-nodes" class="text-5xl font-black header-font tracking-tighter">0</p>
                        <div class="mt-6 flex items-center gap-2 text-[10px] text-red-400 font-black">
                            IMMEDIATE ACTION REQUIRED
                        </div>
                    </div>
                    <div class="glass-panel p-8 border-l-4 border-emerald-500">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em]">Network Reliability</span>
                            <div class="w-8 h-8 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-500">
                                <i class="fas fa-signal-perfect text-xs"></i>
                            </div>
                        </div>
                        <p class="text-5xl font-black header-font tracking-tighter">99.8<span class="text-2xl opacity-50">%</span></p>
                        <div class="mt-6 flex items-center gap-2 text-[10px] text-emerald-500 font-black">
                            AVG LATENCY: 28MS
                        </div>
                    </div>
                    <div class="glass-panel p-8 border-l-4 border-amber-500">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em]">Est. Fill Velocity</span>
                            <div class="w-8 h-8 rounded-lg bg-amber-500/10 flex items-center justify-center text-amber-500">
                                <i class="fas fa-tachometer-alt text-xs"></i>
                            </div>
                        </div>
                        <p class="text-5xl font-black header-font tracking-tighter">18.4<span class="text-2xl opacity-50">%</span></p>
                        <div class="mt-6 flex items-center gap-2 text-[10px] text-amber-500 font-black">
                            PREDICTIVE KERNEL ONLINE
                        </div>
                    </div>
                </div>

                <!-- MAIN HUB -->
                <div class="grid grid-cols-12 gap-10">
                    <!-- GEOSPATIAL -->
                    <div class="col-span-12 lg:col-span-8 space-y-8">
                        <div class="glass-panel p-2 h-[550px] relative map-scan ring-1 ring-white/5">
                            <div id="main-map" class="w-full h-full rounded-[1.2rem] bg-slate-900 overflow-hidden shadow-2xl"></div>
                            <div id="map-loader" class="absolute inset-0 bg-slate-950/90 z-20 flex flex-col items-center justify-center rounded-[1.2rem] backdrop-blur-md">
                                <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"></div>
                                <p class="header-font text-[11px] tracking-[0.4em] text-blue-500 font-black uppercase">Provisioning Satellite Link</p>
                            </div>
                        </div>

                        <!-- LIVE NODES -->
                        <div>
                            <div class="flex justify-between items-center mb-8 px-2">
                                <h3 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.3em] flex items-center gap-4">
                                    <span class="w-12 h-px bg-slate-800"></span>
                                    Node Telemetry Grid
                                </h3>
                                <div class="flex gap-3">
                                    <button class="glass-btn px-4 py-2 rounded-xl text-[10px] font-black tracking-widest uppercase">Filter: High Risk</button>
                                    <button class="glass-btn px-4 py-2 rounded-xl text-[10px] font-black tracking-widest uppercase"><i class="fas fa-download mr-2"></i> Report</button>
                                </div>
                            </div>
                            <div id="bin-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="col-span-full py-32 text-center glass-panel border-dashed opacity-30">
                                    <div class="mb-6"><i class="fas fa-satellite-dish text-5xl"></i></div>
                                    <p class="text-xs uppercase font-black tracking-[0.5em]">Awaiting Distributed Telemetry</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- COMMAND CENTER -->
                    <div class="col-span-12 lg:col-span-4 space-y-8">
                        <!-- TERMINAL -->
                        <div class="glass-panel p-8 flex flex-col h-[450px] ring-1 ring-white/5">
                            <h3 class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-6 flex justify-between items-center">
                                Operational Kernel Feed
                                <span class="flex items-center gap-2 text-emerald-500">
                                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                                    ONLINE
                                </span>
                            </h3>
                            <div id="terminal-container" class="flex-1 p-6 mono-font text-[10px] leading-relaxed overflow-y-auto shadow-inner bg-black/80">
                                <div id="log-feed" class="space-y-2">
                                    <div class="text-blue-500 font-bold">>>> VOLVOWAY PRODUCTION KERNEL INITIALIZED</div>
                                    <div class="text-slate-600">>>> RENDER SERVER DEPLOYMENT: V4.5.2</div>
                                    <div class="text-slate-500">>>> Handshaking with WebSocket Cluster...</div>
                                    <div class="text-slate-500">>>> DB Migration verified (PostgreSQL)...</div>
                                </div>
                            </div>
                        </div>

                        <!-- EMERGENCY CONTROLS -->
                        <div class="glass-panel p-8 ring-1 ring-white/5 bg-gradient-to-b from-slate-900/50 to-slate-950/50">
                            <h3 class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-6 italic">Crisis Management Protocol</h3>
                            <div class="grid grid-cols-2 gap-6">
                                <button class="p-6 bg-red-900/10 border border-red-500/20 rounded-2xl hover:bg-red-500/10 transition group text-center">
                                    <div class="w-10 h-10 mx-auto bg-red-500/10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition duration-500">
                                        <i class="fas fa-bullhorn text-red-500 text-sm"></i>
                                    </div>
                                    <p class="text-[10px] font-black text-white uppercase tracking-widest">Global Alert</p>
                                </button>
                                <button class="p-6 bg-blue-900/10 border border-blue-500/20 rounded-2xl hover:bg-blue-500/10 transition group text-center">
                                    <div class="w-10 h-10 mx-auto bg-blue-500/10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition duration-500">
                                        <i class="fas fa-shipping-fast text-blue-500 text-sm"></i>
                                    </div>
                                    <p class="text-[10px] font-black text-white uppercase tracking-widest">Fleet Scramble</p>
                                </button>
                            </div>
                        </div>

                        <!-- EVENT FEED -->
                        <div class="glass-panel p-8 ring-1 ring-white/5">
                            <h3 class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
                                <i class="fas fa-history text-[9px]"></i> Regional Event Timeline
                            </h3>
                            <div class="space-y-6" id="event-mini-list">
                                <div class="flex gap-4 items-center opacity-40">
                                    <div class="w-1 h-10 bg-slate-800 rounded-full"></div>
                                    <div class="text-[10px]">
                                        <p class="font-black text-slate-300">KERNEL_COLD_BOOT</p>
                                        <p class="text-slate-600 font-bold">SYSTEM_STARTUP_OK</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: ANALYTICS -->
            <section id="view-analytics" class="space-y-10 hidden opacity-0 transition-opacity duration-500">
                <div class="flex flex-col md:flex-row justify-between items-end gap-6 mb-6">
                    <div>
                        <h2 class="header-font text-3xl font-black text-blue-400">NODE INTELLIGENCE</h2>
                        <p class="text-xs text-slate-500 font-bold uppercase tracking-widest mt-1">Multi-node heuristic regression models</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="px-6 py-3 glass-panel rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-3">
                            <span class="text-slate-500">Interval:</span>
                            <select class="bg-transparent border-none outline-none text-white font-black">
                                <option>T-24 Hours</option>
                                <option>T-7 Days</option>
                                <option>T-30 Days</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-12 gap-10">
                    <div class="col-span-12 lg:col-span-8 glass-panel p-10 ring-1 ring-white/5">
                        <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.3em] mb-10 border-b border-slate-800 pb-4">Payload Trajectory Velocity</h3>
                        <div id="chart-main-history" class="h-[450px]"></div>
                    </div>
                    <div class="col-span-12 lg:col-span-4 glass-panel p-10 ring-1 ring-white/5">
                        <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.3em] mb-10 border-b border-slate-800 pb-4">Cluster Utilization</h3>
                        <div id="chart-pie-nodes" class="h-[450px]"></div>
                    </div>

                    <div class="col-span-12 lg:col-span-6 glass-panel p-10 ring-1 ring-white/5">
                        <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.3em] mb-10 border-b border-slate-800 pb-4">Anomalous Activity Matrix</h3>
                        <div id="chart-heatmap-alerts" class="h-[350px]"></div>
                    </div>
                    <div class="col-span-12 lg:col-span-6 glass-panel p-10 ring-1 ring-white/5">
                        <h3 class="text-xs font-black text-slate-500 uppercase tracking-[0.3em] mb-10 border-b border-slate-800 pb-4">Officer KPI Efficiency</h3>
                        <div id="chart-bar-response" class="h-[350px]"></div>
                    </div>
                </div>
            </section>

            <!-- VIEW: FLEET -->
            <section id="view-fleet" class="space-y-10 hidden opacity-0 transition-opacity duration-500">
                <div class="glass-panel overflow-hidden border-none shadow-2xl">
                    <div class="p-8 bg-slate-900/80 border-b border-slate-800">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.5em]">Municipal Field Personnel</h3>
                    </div>
                    <table class="w-full text-left">
                        <thead class="bg-slate-950/40">
                            <tr>
                                <th class="p-6 text-[10px] font-black text-slate-500 uppercase tracking-widest">Authorized Name</th>
                                <th class="p-6 text-[10px] font-black text-slate-500 uppercase tracking-widest">Operational Role</th>
                                <th class="p-6 text-[10px] font-black text-slate-500 uppercase tracking-widest">Auth Status</th>
                                <th class="p-6 text-[10px] font-black text-slate-500 uppercase tracking-widest">Emergency Uplink</th>
                                <th class="p-6 text-[10px] font-black text-slate-500 uppercase tracking-widest">Avg Efficiency</th>
                            </tr>
                        </thead>
                        <tbody id="fleet-table-body" class="divide-y divide-slate-800/50">
                            <tr class="hover:bg-blue-600/5 transition duration-300">
                                <td class="p-6"><div class="flex items-center gap-4"><div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-[10px] font-black">JS</div><span class="text-sm font-bold">Jaswanth (Admin)</span></div></td>
                                <td class="p-6 text-xs text-slate-400 font-bold uppercase">Field Ops Commander</td>
                                <td class="p-6"><span class="bg-green-500/10 text-green-500 border border-green-500/20 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest">Authenticated</span></td>
                                <td class="p-6 mono-font text-blue-400 text-sm font-bold">+91 8978716587</td>
                                <td class="p-6 text-xs text-slate-400 font-black tracking-widest uppercase">94.8%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

        </div>
    </main>

    <!-- 3. MODALS -->
    
    <!-- MODAL: PROVISIONING -->
    <div id="regModal" class="fixed inset-0 bg-slate-950/95 hidden items-center justify-center p-6 z-[100] backdrop-blur-2xl">
        <div class="glass-panel p-12 max-w-xl w-full shadow-3xl modal-enter ring-1 ring-blue-500/30">
            <h2 class="header-font text-2xl font-black text-blue-400 mb-8 uppercase tracking-tighter">Authorize Hardware Node</h2>
            <div class="space-y-8">
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase ml-1 tracking-widest">Asset Index (e.g. BIN-001)</label>
                        <input id="reg-id" type="text" placeholder="NODE_ID" class="w-full bg-slate-900/50 p-4 rounded-2xl border border-slate-800 focus:border-blue-500 outline-none text-sm font-bold mt-2 shadow-inner">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase ml-1 tracking-widest">Field Supervisor</label>
                        <input id="reg-supervisor" type="text" placeholder="NAME" class="w-full bg-slate-900/50 p-4 rounded-2xl border border-slate-800 focus:border-blue-500 outline-none text-sm font-bold mt-2 shadow-inner">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase ml-1 tracking-widest">Deployment Latitude</label>
                        <input id="reg-lat" type="number" step="any" placeholder="14.4713" class="w-full bg-slate-900/50 p-4 rounded-2xl border border-slate-800 focus:border-blue-500 outline-none text-sm font-bold mt-2 shadow-inner">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-500 uppercase ml-1 tracking-widest">Deployment Longitude</label>
                        <input id="reg-lon" type="number" step="any" placeholder="80.1007" class="w-full bg-slate-900/50 p-4 rounded-2xl border border-slate-800 focus:border-blue-500 outline-none text-sm font-bold mt-2 shadow-inner">
                    </div>
                </div>
                <div class="flex gap-6 pt-10">
                    <button onclick="submitRegistration()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-2xl text-[11px] uppercase tracking-[0.3em] shadow-2xl shadow-blue-600/30 transition-all border border-blue-400/20">Commit Protocol</button>
                    <button onclick="toggleModal('regModal')" class="flex-1 bg-slate-800/50 text-slate-400 font-bold py-5 rounded-2xl text-[11px] uppercase tracking-widest transition-all">Abort</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: NODE INSPECTOR -->
    <div id="inspectorModal" class="fixed inset-0 bg-slate-950/95 hidden items-center justify-center p-6 z-[100] backdrop-blur-2xl">
        <div class="glass-panel p-10 max-w-5xl w-full shadow-3xl modal-enter overflow-y-auto max-h-[95vh] ring-1 ring-white/10">
            <div class="flex justify-between items-start mb-10 border-b border-slate-800/50 pb-8">
                <div>
                    <h2 class="header-font text-4xl font-black text-blue-500 tracking-tighter uppercase" id="insp-id">BIN-XXX</h2>
                    <p class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] mt-2" id="insp-location">Regional Deployment: Sector-NE-04</p>
                </div>
                <button onclick="toggleModal('inspectorModal')" class="w-12 h-12 rounded-2xl bg-slate-900 flex items-center justify-center text-slate-500 hover:text-white transition shadow-xl"><i class="fas fa-times text-xl"></i></button>
            </div>

            <div class="grid grid-cols-12 gap-10">
                <!-- METRICS -->
                <div class="col-span-12 lg:col-span-4 space-y-8">
                    <div class="p-10 bg-slate-900/50 rounded-3xl border border-slate-800 text-center shadow-inner">
                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-8">Active Payload Capacity</p>
                        <div class="relative w-40 h-40 mx-auto mb-8 flex items-center justify-center">
                            <svg class="w-full h-full transform -rotate-90">
                                <circle cx="80" cy="80" r="74" stroke="rgba(255,255,255,0.02)" stroke-width="10" fill="transparent" />
                                <circle id="insp-gauge-circle" cx="80" cy="80" r="74" stroke="var(--primary-blue)" stroke-width="10" fill="transparent" stroke-dasharray="464.9" stroke-dashoffset="464.9" stroke-linecap="round" class="transition-all duration-1000" />
                            </svg>
                            <span class="absolute text-4xl font-black header-font" id="insp-load-val">0%</span>
                        </div>
                        <p class="text-[10px] font-black uppercase tracking-widest py-2 px-4 rounded-full inline-block" id="insp-status-badge">STANDBY</p>
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-[10px] font-black uppercase p-5 glass-panel ring-1 ring-white/5">
                            <span class="text-slate-500 tracking-widest">Supervisor</span>
                            <span id="insp-supervisor" class="text-white">Jaswanth</span>
                        </div>
                        <div class="flex justify-between items-center text-[10px] font-black uppercase p-5 glass-panel ring-1 ring-white/5">
                            <span class="text-slate-500 tracking-widest">RSSI Signal</span>
                            <span id="insp-signal" class="text-blue-400 font-bold">-74 dBm</span>
                        </div>
                        <div class="flex justify-between items-center text-[10px] font-black uppercase p-5 glass-panel ring-1 ring-white/5">
                            <span class="text-slate-500 tracking-widest">GPS Satellites</span>
                            <span id="insp-sats" class="text-emerald-500 font-bold">12 Lock</span>
                        </div>
                    </div>
                </div>

                <!-- TRENDS -->
                <div class="col-span-12 lg:col-span-8 space-y-8">
                    <div class="p-10 bg-slate-900/50 rounded-3xl border border-slate-800 h-[320px] shadow-inner">
                        <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Historical Fill Matrix (Last 12 Hours)</h3>
                        <div id="chart-node-history" class="h-56 w-full"></div>
                    </div>
                    
                    <div class="space-y-6">
                        <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Kernel Operational Logs</h3>
                        <div id="insp-logs" class="space-y-3 max-h-56 overflow-y-auto text-[9px] mono-font pr-4">
                            <!-- Node Specific Logs -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. CORE ENGINE -->
    <script>
        // --- CONSTANTS ---
        const socket = io();
        let registeredBins = [];
        let telemetryData = {};
        let currentView = 'overview';

        // --- CLOCK ---
        function updateTime() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('en-US', { weekday: 'LONG', year: 'numeric', month: 'LONG', day: 'NUMERIC' }).toUpperCase();
            document.getElementById('current-time').innerText = now.toLocaleTimeString('en-US', { hour12: false }) + " UTC";
        }
        setInterval(updateTime, 1000);
        updateTime();

        // --- NAVIGATION ENGINE ---
        function switchView(viewId) {
            const viewport = document.getElementById('viewport');
            const sections = document.querySelectorAll('#viewport section');
            
            // Fade out current
            sections.forEach(s => {
                s.style.opacity = '0';
                setTimeout(() => s.classList.add('hidden'), 300);
            });

            // Update UI Active State
            document.querySelectorAll('aside nav div').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + viewId).classList.add('active');

            // Switch and Fade In
            setTimeout(() => {
                const target = document.getElementById('view-' + viewId);
                target.classList.remove('hidden');
                setTimeout(() => target.style.opacity = '1', 50);
                
                currentView = viewId;
                if (viewId === 'analytics') renderAnalyticsCharts();
                if (viewId === 'overview') setTimeout(renderMap, 200);
            }, 300);
        }

        function toggleModal(id) {
            const el = document.getElementById(id);
            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
                el.classList.add('flex');
            } else {
                el.classList.add('hidden');
                el.classList.remove('flex');
            }
        }

        // --- TELEMETRY SUBSYSTEM ---
        socket.on('update', (data) => {
            console.log(">>> [TELEMETRY_RX]", data);
            telemetryData[data.bin_id] = { ...telemetryData[data.bin_id], ...data, lastUpdate: new Date() };
            
            // Uplink Status Feedback
            const hwStatus = document.getElementById('hw-status');
            hwStatus.className = "flex items-center gap-3 px-4 py-2 rounded-xl bg-blue-950/20 border border-blue-500/20 text-[10px] font-black text-blue-500";
            hwStatus.innerHTML = '<div class="w-2 h-2 rounded-full bg-blue-500 live-dot"></div> SECURE UPLINK ACTIVE';

            // Auditable Log
            addLog(data.bin_id, data.status_msg);

            // Update Dynamic Components
            if (currentView === 'overview') {
                renderOverviewWidgets();
                if (data.lat && data.lat !== 0) {
                    const loader = document.getElementById('map-loader');
                    if (loader) loader.classList.add('hidden');
                    renderMap();
                }
            }
            updateSummaryStats();
        });

        function addLog(id, msg) {
            const feed = document.getElementById('log-feed');
            const entry = document.createElement('div');
            entry.className = "mb-2 border-l-2 border-slate-800 pl-4 py-1 hover:bg-white/5 transition duration-300";
            entry.innerHTML = `
                <span class="text-slate-600 font-mono">[${new Date().toLocaleTimeString()}]</span> 
                <span class="text-blue-500 font-black uppercase tracking-tighter">${id}:</span> 
                <span class="text-slate-300 font-bold uppercase tracking-widest">${msg}</span>
            `;
            feed.prepend(entry);
            if (feed.childNodes.length > 100) feed.lastChild.remove();

            // Side Event List
            const mini = document.getElementById('event-mini-list');
            const mEntry = document.createElement('div');
            mEntry.className = "flex gap-4 items-center";
            mEntry.innerHTML = `
                <div class="w-1.5 h-10 bg-blue-600 rounded-full"></div>
                <div class="text-[10px]">
                    <p class="font-black text-white uppercase tracking-tighter">${id} STATUS_TRANSITION</p>
                    <p class="text-slate-500 font-bold uppercase">${msg}</p>
                </div>
            `;
            mini.prepend(mEntry);
            if (mini.childNodes.length > 8) mini.lastChild.remove();
        }

        function updateSummaryStats() {
            let criticalCount = 0;
            Object.values(telemetryData).forEach(d => {
                if (d.fill_percentage >= 90) criticalCount++;
            });
            document.getElementById('stat-total-nodes').innerText = registeredBins.length;
            document.getElementById('stat-critical-nodes').innerText = criticalCount;
        }

        // --- MAP ENGINE (PLOTLY) ---
        function renderMap() {
            const lats = [], lons = [], text = [], colors = [];
            
            registeredBins.forEach(bin => {
                const live = telemetryData[bin.id];
                const lat = live?.lat || bin.lat;
                const lon = live?.lon || bin.lon;
                const fill = live?.fill_percentage || 0;
                
                if (lat !== 0) {
                    lats.push(lat);
                    lons.push(lon);
                    text.push(`${bin.id}: ${fill}% CAPACITY`);
                    colors.push(fill >= 90 ? '#ef4444' : (fill >= 70 ? '#f59e0b' : '#3b82f6'));
                }
            });

            const data = [{
                type: 'scattermapbox',
                lat: lats, lon: lons,
                mode: 'markers+text',
                marker: { size: 22, color: colors, opacity: 0.8 },
                text: text,
                textposition: 'top right',
                textfont: { family: 'Orbitron', size: 11, color: 'white' }
            }];

            const layout = {
                mapbox: { 
                    style: 'stamen-terrain', 
                    center: { lat: lats[0] || 14.4713, lon: lons[0] || 80.1007 }, 
                    zoom: 14 
                },
                margin: { r: 0, t: 0, l: 0, b: 0 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                showlegend: false
            };

            Plotly.newPlot('main-map', data, layout, { responsive: true, displayModeBar: false });
        }

        // --- GRID ENGINE ---
        function renderOverviewWidgets() {
            const container = document.getElementById('bin-grid');
            if (registeredBins.length === 0) return;
            
            container.innerHTML = '';
            registeredBins.forEach(bin => {
                const live = telemetryData[bin.id] || { fill_percentage: 0, status_msg: "LINKING..." };
                const isCritical = live.fill_percentage >= 90;

                const card = `
                    <div class="glass-panel p-8 bin-card group cursor-pointer ${isCritical ? 'border-red-500/50 shadow-2xl shadow-red-900/10' : ''}" onclick="openInspector('${bin.id}')">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h4 class="header-font text-base text-blue-500 font-black tracking-tighter">${bin.id}</h4>
                                <p class="text-[9px] font-black text-slate-500 uppercase mt-2 tracking-[0.2em]">${live.status_msg}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-3xl font-black ${isCritical ? 'text-red-500 animate-pulse' : 'text-white'}">${live.fill_percentage}%</span>
                                <p class="text-[8px] font-black text-slate-500 uppercase tracking-widest mt-1">Payload</p>
                            </div>
                        </div>

                        <div class="w-full bg-slate-950 h-2.5 rounded-full overflow-hidden shadow-inner mb-6 ring-1 ring-white/5">
                            <div class="h-full transition-all duration-1000 ease-in-out ${isCritical ? 'bg-red-500 shadow-lg shadow-red-500/50' : 'bg-blue-600 shadow-lg shadow-blue-500/50'}" style="width: ${live.fill_percentage}%"></div>
                        </div>

                        <div class="flex justify-between items-center pt-6 border-t border-slate-800/50">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-2xl bg-slate-800/50 border border-slate-700 flex items-center justify-center text-[10px] font-black uppercase text-slate-500 group-hover:bg-blue-500/10 group-hover:text-blue-500 transition duration-500">
                                    ${bin.supervisor ? bin.supervisor[0] : 'U'}
                                </div>
                                <div>
                                    <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Field Auth</p>
                                    <p class="text-xs font-bold text-slate-200">${bin.supervisor || 'UNASSIGNED'}</p>
                                </div>
                            </div>
                            <button class="w-8 h-8 rounded-full border border-slate-800 flex items-center justify-center text-blue-500 group-hover:bg-blue-600 group-hover:text-white transition duration-500 transform group-hover:scale-110">
                                <i class="fas fa-chevron-right text-[10px]"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', card);
            });
        }

        // --- INTELLIGENCE ENGINE (ANALYTICS) ---
        function renderAnalyticsCharts() {
            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#64748b', family: 'Inter', size: 10 },
                xaxis: { showgrid: false, zeroline: false },
                yaxis: { gridcolor: 'rgba(255,255,255,0.05)', range: [0, 100], zeroline: false },
                margin: { t: 20, b: 40, l: 40, r: 20 },
                showlegend: false
            };

            // Main Trajectory
            const trajectory = {
                x: Array.from({length: 24}, (_, i) => i + ":00"),
                y: Array.from({length: 24}, () => Math.floor(Math.random() * 100)),
                type: 'scatter',
                mode: 'lines',
                line: { shape: 'spline', color: '#3b82f6', width: 4 },
                fill: 'tozeroy',
                fillcolor: 'rgba(59, 130, 246, 0.05)'
            };
            Plotly.newPlot('chart-main-history', [trajectory], layout, {responsive: true});

            // Utilization Pie
            const pie = {
                values: [45, 25, 20, 10],
                labels: ['Sector A', 'Sector B', 'Sector C', 'Unmapped'],
                type: 'pie',
                hole: 0.7,
                marker: { colors: ['#3b82f6', '#10b981', '#f59e0b', '#1e293b'] },
                textfont: { size: 10, color: 'white' }
            };
            Plotly.newPlot('chart-pie-nodes', [pie], { ...layout, showlegend: true, legend: {orientation: 'h', y: -0.2} });
            
            // Heatmap Matrix
            const zValues = Array.from({length: 7}, () => Array.from({length: 24}, () => Math.floor(Math.random() * 15)));
            Plotly.newPlot('chart-heatmap-alerts', [{
                z: zValues,
                x: Array.from({length: 24}, (_, i) => i),
                y: ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'],
                type: 'heatmap',
                colorscale: 'Electric',
                showscale: false
            }], layout);

            // Efficiency Bar
            const bar = {
                x: ['Jaswanth', 'Kumar', 'Rahul', 'Prasad'],
                y: [98, 85, 92, 78],
                type: 'bar',
                marker: { color: 'rgba(59, 130, 246, 0.6)', line: { color: '#3b82f6', width: 2 } }
            };
            Plotly.newPlot('chart-bar-response', [bar], layout);
        }

        // --- INSPECTOR LOGIC ---
        function openInspector(id) {
            const bin = registeredBins.find(b => b.id === id);
            const live = telemetryData[id] || { fill_percentage: 0, status_msg: "OFFLINE" };
            
            document.getElementById('insp-id').innerText = id;
            document.getElementById('insp-supervisor').innerText = bin.supervisor || 'PROVISION_REQD';
            document.getElementById('insp-load-val').innerText = live.fill_percentage + "%";
            
            // Gauge Animation
            const circle = document.getElementById('insp-gauge-circle');
            const circumference = 2 * Math.PI * 74;
            const offset = circumference - (live.fill_percentage / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // Status Logic
            const badge = document.getElementById('insp-status-badge');
            const isCrit = live.fill_percentage >= 90;
            badge.innerText = isCrit ? "CRITICAL_AUTH" : "STABLE_OPS";
            badge.className = `text-[10px] font-black uppercase tracking-widest py-2 px-6 rounded-full inline-block ${isCrit ? "bg-red-500/10 text-red-500 ring-1 ring-red-500/30" : "bg-green-500/10 text-green-500 ring-1 ring-green-500/30"}`;

            // Mini History inside Inspector
            const trace = {
                x: Array.from({length: 12}, (_, i) => i + "H"),
                y: Array.from({length: 12}, () => Math.floor(Math.random() * 80 + 20)),
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#3b82f6', width: 3, shape: 'spline' },
                marker: { size: 6, color: '#fff' }
            };
            Plotly.newPlot('chart-node-history', [trace], {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#64748b', size: 9 },
                xaxis: { showgrid: false },
                yaxis: { gridcolor: 'rgba(255,255,255,0.05)' },
                margin: { t: 5, b: 30, l: 30, r: 5 }
            });

            toggleModal('inspectorModal');
        }

        // --- BOOTSTRAP SUBSYSTEM ---
        async function submitRegistration() {
            const data = {
                id: document.getElementById('reg-id').value,
                supervisor: document.getElementById('reg-supervisor').value,
                lat: parseFloat(document.getElementById('reg-lat').value || 0),
                lon: parseFloat(document.getElementById('reg-lon').value || 0)
            };
            const res = await fetch('/api/v1/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if(res.ok) {
                toggleModal('regModal');
                boot(); 
            }
        }

        async function boot() {
            try {
                const res = await fetch('/api/v1/bins');
                registeredBins = await res.json();
                renderOverviewWidgets();
                updateSummaryStats();
                setTimeout(renderMap, 600);
                setTimeout(() => document.getElementById('view-overview').style.opacity = '1', 100);
            } catch (err) {
                console.error("BOOT_FAILURE:", err);
            }
        }

        window.onload = boot;
    </script>
</body>
</html>